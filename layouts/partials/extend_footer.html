<script>
document.querySelectorAll('pre > code').forEach((codeBlock) => {
    // 1. åˆ›å»ºè¯Šæ–­æŒ‰é’®
    const btn = document.createElement('button');
    btn.innerHTML = 'ğŸª„ AI è¯Šæ–­';
    btn.style = 'margin: 10px; padding: 4px 12px; cursor: pointer; border-radius: 6px; background: #333; color: #fff; border: 1px solid #555; font-size: 13px;';
    
    // 2. ç»‘å®šç‚¹å‡»äº‹ä»¶
    btn.onclick = async () => {
        const originalText = btn.innerHTML;
        btn.innerHTML = 'âŒ› åˆ†æä¸­...';
        btn.disabled = true;

        try {
            const response = await fetch('https://gemini-worker.xiepearl85.workers.dev/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ code: codeBlock.innerText })
            });
            
            const data = await response.json();
            if (data.result) {
                // ä½¿ç”¨åŸç”Ÿå¼¹çª—æ˜¾ç¤ºç»“æœï¼Œæˆ–è€…ä½ å¯ä»¥è‡ªå®šä¹‰æ›´æ¼‚äº®çš„ UI
                alert("Gemini åˆ†æå»ºè®®ï¼š\n\n" + data.result);
            } else {
                alert("åˆ†æå¤±è´¥ï¼š" + (data.error || "æœªçŸ¥é”™è¯¯"));
            }
        } catch (err) {
            alert("ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥ Worker æ˜¯å¦é…ç½®æ­£ç¡®");
        } finally {
            btn.innerHTML = originalText;
            btn.disabled = false;
        }
    };

    // 3. å°†æŒ‰é’®æ’å…¥åˆ°ä»£ç å—åé¢
    codeBlock.parentNode.appendChild(btn);
});
</script>